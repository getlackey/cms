# Custom Themes

We don't really have the concept of themes in this CMS. What we have is a couple of folders that can be used to change how a website looks.
- app/views 
- app/public/

**Don't use htdocs folder**.
That folder is generated by our Grunt Tasks and most of those files are copyied from app/public. Any assets should be placed inside app/public and **grunt build** will process them and place a version in the htdocs folder.

If you're using any webserver like NginX to speed up file serving you should point it to htdocs, though.

## CSS
We like to use scss for our style sheets. You will find several folders in app/public/css/ that make the final style sheet. Unless you want to redesign the entire CMS layout or replace the framework all you should change is inside app/public/css/custom.

You can obviously change everything in the CSS folder and create a completely unique experience in this new website, but for most projects the custom folder will be enough.

## JS
Files in the js-libs will only be copied to htdocs. On the other hand, files app/public/js will be parsed with browserify and validated against jslint. If you have no need for any of these tools look into the app/tasks folder and app/Gruntfile.js to disable them.

## Angular views
There is a couple of angular views (html files) stored in app/public/views. These are angular templates used in the admin interface.

## Template Views
Before anything you should be comfortable with [dustjs](http://www.dustjs.com/), the template system we use.

If you look at most of the templates you will see something like this:

```
{>"layouts/master" /}

{<body}
	...
{/body}
```

The first line includes the master layout. It's perfectly fine to have multiple layout, if you require them.  

The master layout in its turn will have something like this in its source:
```
{+body /}
```

The **{+body /}** is an [inline partial](http://www.dustjs.com/guides/blocks/). 

So, the template we used as example is loading the master layout and then it is defining a body block that will be replaced inside the master layout, wherever the  **{+body /}** tag is defined. The order by wich we define this blocks is irrelevant as they will be processed before any rendering occours.

If you look at our default page templates in app/views/pages/templates you will see something like this:

```
{>"_partials/pages/blocks/tabs/index" 
	lkVar="pages.{id}:body.blocks.0" data=body.blocks[0] 
	numTabs=4
/}
```
In this case we are including a partial view and defining some variables that will be made available to the template. This is really useful to re-use templates with minor variations.

Dustjs is really powerfull and we can't recomend it enough.

### Context variables

We are injecting some variables to dustjs context. These are exposed in the _locals object as well as being exposed in the main context. We advise the usage of the _locals object to minimise conflicts with other properties.

- {_locals.url}
	- {_locals.url.protocol}
	- {_locals.url.slashes}
	- {_locals.url.auth}
	- {_locals.url.host}
	- {_locals.url.port}
	- {_locals.url.hostname}
	- {_locals.url.search}
	- {_locals.url.query}
	- {_locals.url.pathname} // array
	- {_locals.url.path}
	- {_locals.url.href}
- {_locals.req.query}
- {_locals.req.params}
- {_locals.env} // Node environment
- {_locals.user} // object with user properties
- {_locals.jwt} // current user token
- {_locals.session} // current session object
- {_locals.isEdit} // is the current user an admin in any page except /cms/*?
- {_locals.isCMS} // is the current user an admin in any /cms page?

### DustJs Helpers
We are including the default helpers from Dustjs. To know more see [the tutorial](http://www.dustjs.com/guides/dust-helpers/)

We also have a user helper to validate user groups:

```
{@user isAny="admin developer"}
    ...
{:else}
    ...
{/user}
```

And some other helpers:

- [lackey-dustjs-mongoose](https://www.npmjs.com/package/lackey-dustjs-mongoose)
- [lackey-dustjs-options](https://www.npmjs.com/package/lackey-dustjs-options)
- [lackey-dustjs-var](https://www.npmjs.com/package/lackey-dustjs-var)
- [lackey-dustjs-api](https://www.npmjs.com/package/lackey-dustjs-api)

### Inline edit
With the information in this help file, you should be able to build static HTML templates with placeholder copy. This is usualy how we start building a website - we then use the REST API to inject data using something like [postman](https://www.getpostman.com/). 

Remember we can access any url with the .json extension to see the data we have for that resource. 

Now we will need to connect the data provided by our URLS to our views. We can just wrap the property in curly brackets and it will be exposed in the template - e.g. {title} or {body.excerpt}. 

That will show data from the database but it will not make it editable. For that we use the [lackey-dustjs-var](https://www.npmjs.com/package/lackey-dustjs-var) helper.

```
{@var name="pages.{id}:title" type="text" placeholder="Insert Title" /}
```
This tag will create a title that you can edit directly by clicking on it. It detects if the current user is an admin and only renders the editable interface for those users. For everyone else, only the title value will be returned.

If it's an admin user what is returned is a tag that will be rendered by an Angularjs application. For more information about the options available check [its documentation](https://www.npmjs.com/package/lackey-inline-edit)